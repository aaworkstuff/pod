<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>TSI Guidance (No-Login) — Lone Star College</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
      line-height: 1.45;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    .header-banner, .footer-banner {
      background: #003366;
      color: #fff;
      text-align: center;
      padding: 20px;
      font-weight: bold;
    }
    .footer-banner { font-size: 14px; margin-top: auto; }

    .main-container { max-width: 1000px; margin: 20px auto; padding: 0 20px; flex: 1; }
    .page-title { font-size: 24px; font-weight: bold; color: #003366; margin-bottom: 20px; }

    .app-card {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,.08);
    }

    .progress-steps {
      display: flex; justify-content: space-between; margin-bottom: 30px;
      padding: 20px 0; border-bottom: 1px solid #eee;
    }
    .step { flex: 1; text-align: center; position: relative; color: #999; font-size: 14px; }
    .step-number {
      width: 30px; height: 30px; border-radius: 50%; background: #eee; color: #999;
      display: inline-flex; align-items: center; justify-content: center; margin-bottom: 6px; font-weight: bold;
    }
    .step.active { color: #003366; font-weight: bold; }
    .step.active .step-number { background: #003366; color: #fff; }
    .step.completed { color: #28a745; }
    .step.completed .step-number { background: #28a745; color: #fff; }

    .form-section { margin-bottom: 24px; }
    .form-section h3 { color: #003366; font-size: 18px; margin-bottom: 12px; padding-bottom: 6px; border-bottom: 2px solid #e6f3ff; }
    .form-group { margin-bottom: 14px; }
    label { display: block; font-weight: bold; margin-bottom: 6px; }
    input[type="text"], select, a.inline-link {
      width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px;
    }
    a.inline-link { display:inline-block; text-decoration:none; color:#003366; border:none; padding:0; width:auto; }

    .hint { font-size: 12px; color: #666; margin-top: 6px; }

    /* Each checkbox/radio on its own line */
    .stack-list { display: grid; grid-template-columns: 1fr; gap: 10px; }
    .stack-item { display: flex; align-items: flex-start; gap: 8px; }
    .stack-item input { margin-top: 2px; }

    .exemption-category { border: 1px solid #ddd; border-radius: 6px; margin-bottom: 14px; }
    .category-header {
      background: #f8f9fa; padding: 14px; border-bottom: 1px solid #ddd; cursor: pointer; font-weight: bold;
      color: #003366; display: flex; justify-content: space-between; align-items: center;
    }
    .category-header:hover { background: #e9ecef; }
    .category-content { padding: 16px; display: none; }
    .category-content.open { display: block; }
    .expand-icon { transition: transform .25s; }
    .category-header.open .expand-icon { transform: rotate(180deg); }

    .status-pill { display: inline-block; padding: 4px 12px; border-radius: 16px; font-size: 12px; font-weight: bold; }
    .status-exempt { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
    .status-needed { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
    .status-warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }

    .btn-group { display: flex; justify-content: space-between; margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee; }
    .btn { padding: 12px 22px; border: none; border-radius: 4px; font-size: 14px; font-weight: bold; cursor: pointer; text-decoration: none; display: inline-block; transition: background-color .2s; }
    .btn-primary { background: #003366; color: #fff; }
    .btn-primary:hover { background: #002244; }
    .btn-secondary { background: #6c757d; color: #fff; }
    .btn-secondary:hover { background: #545b62; }
    .btn-outline { background: #fff; color: #003366; border: 1px solid #003366; }
    .btn-outline:hover { background: #003366; color: #fff; }
    .btn-small { padding: 8px 12px; font-size: 12px; }
    .btn:disabled { opacity: .55; cursor: not-allowed; }

    .info-card {
      background: #e6f3ff; padding: 16px; border-left: 4px solid #003366; border-radius: 4px; margin-bottom: 16px;
    }
    .warn-card { background: #fff7df; border-left-color: #ffb300; }
    .danger-card { background: #fdeaea; border-left-color: #c82333; }

    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
    .info-table { width: 100%; border-collapse: collapse; margin: 10px 0; }
    .info-table th, .info-table td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
    .info-table th { background: #f8f9fa; color: #003366; }

    #resetButtonsContainer { display: flex; justify-content: flex-end; gap: 10px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee; }

    @media (max-width: 768px) {
      .progress-steps { flex-direction: column; gap: 10px; }
      .two-col { grid-template-columns: 1fr; }
      .btn-group { flex-direction: column; gap: 10px; }
      .main-container { padding: 0 10px; }
    }

    @media print {
      .header-banner, .footer-banner, .btn-group, #resetButtonsContainer, .progress-steps { display: none !important; }
      .app-card { box-shadow: none; border: none; }
      body { background: #fff; }
    }
  </style>
</head>
<body>
  <div class="header-banner">LSC Header Goes Here</div>

  <div class="main-container">
    <h1 class="page-title">TSI Guidance (No-Login)</h1>

    <div class="app-card">

      <div id="resetButtonsContainer" style="display:none;">
        <button class="btn btn-outline btn-small" id="resetPageBtn">Reset Page</button>
        <button class="btn btn-outline btn-small" id="startOverBtn">Start Over</button>
      </div>

      <div class="progress-steps" id="progressSteps"></div>

      <div id="pageContent"></div>

      <div class="btn-group" id="navigationButtons" style="display:none;">
        <div>
          <button class="btn btn-outline btn-small" id="printBtn">Print / Save PDF</button>
        </div>
        <div>
          <button class="btn btn-secondary" id="backBtn">Previous</button>
          <button class="btn btn-primary" id="nextBtn">Next</button>
        </div>
      </div>
    </div>
  </div>

  <div class="footer-banner">LSC Footer Goes Here</div>

  <script>
    /**** SCORE THRESHOLDS (prototype) ****/
    const CUTS = {
      SAT: { ERW: 480, MATH: 530 },
      ACT: {
        NEW: { ERsum: 40, MATH: 22 },           // on/after 2023-02-15
        OLD: { ENG: 19, MATH: 19, COMP: 23 }    // before 2023-02-15 (prototype)
      },
      GED: { RLA: 165, MATH: 165 },
      HISET: { READ: 15, WRITE: 15, ESSAY: 4, MATH: 15 },
      STAAR: { ENG3: 4000, ALG2: 4000 }         // prototype simple display
    };

    /**** OFFICIAL SUBMISSION METHODS (from your earlier code) ****/
    const OFFICIAL_METHODS = {
      transcript: [
        'Sent electronically by your previous college or university',
        'Official PDF emailed directly from college/university to Registrar@LoneStar.edu'
      ],
      act: ['Official ACT scores sent via ACT website to LSC (School Code: 006508)'],
      sat: ['Official SAT scores sent via collegeboard.org to LSC (School Code: 006508)'],
      ged: ['Official GED scores submitted via GED Testing Service Website'],
      hiset: ['Official HiSET scores submitted via ETS HiSET Test website'],
      staar: ['Official high school transcript sent directly from high school'],
      military: [
        'DD-214 or military documentation sent directly from military records',
        'Official military transcript or documentation mailed to LSC Registrar'
      ],
      cpp: [
        'Official high school transcript sent directly from high school',
        'Documentation from partnered school district sent to LSC'
      ]
    };

    /**** FLOW ****/
    const STEPS = [
      { key: 'welcome', label: 'Welcome' },
      { key: 'applied', label: 'Apply' },
      { key: 'login', label: 'Log in & Checklist' },
      { key: 'english', label: 'English' },
      { key: 'math', label: 'Math' },
      { key: 'results', label: 'Results' }
    ];

    /**** STATE ****/
    const state = {
      stepIndex: 0,
      answers: {
        hasApplied: null,       // true | false
        hasLoggedIn: null,      // true | false
        english: blankArea(true),
        math: blankArea(false)
      },
      ui: { open: {} }
    };

    function blankArea(includeESOL_CPP) {
      return {
        degree:false,
        transferCredit:false,
        priorReady:false,
        activeDuty:false,
        veteran:false,
        level1:false,
        esol: includeESOL_CPP ? false : false,
        cpp: includeESOL_CPP ? false : false,

        // Score checkboxes (they check ONLY if they meet the threshold)
        sat_erw:false,
        act_new_er:false,
        act_old_eng_comp:false,
        ged_rla:false,
        hiset_rw:false,
        staar_eng3:false,

        sat_math:false,
        act_new_math:false,
        act_old_math_comp:false,
        ged_math:false,
        hiset_math:false,
        staar_alg2:false
      };
    }

    /**** RENDER CORE ****/
  function renderProgress() {
  const el = document.getElementById('progressSteps');
  el.innerHTML = STEPS.map((s, i) => `
    <div class="step ${i === state.stepIndex ? 'active' : i < state.stepIndex ? 'completed' : ''}">
      <div class="step-number">${i + 1}</div>
      <div>${s.label}</div>
    </div>
  `).join('');
}


    function render() {
      const current = STEPS[state.stepIndex];

      document.getElementById('progressSteps').style.display = (current.key === 'welcome') ? 'none' : 'flex';
      document.getElementById('navigationButtons').style.display = (current.key === 'welcome') ? 'none' : 'flex';
      document.getElementById('resetButtonsContainer').style.display = ['applied','login','english','math'].includes(current.key) ? 'flex' : 'none';

      renderProgress();

      const container = document.getElementById('pageContent');
      switch (current.key) {
        case 'welcome': renderWelcome(container); break;
        case 'applied': renderApplied(container); break;
        case 'login': renderLogin(container); break;
        case 'english': renderEnglish(container); break;
        case 'math': renderMath(container); break;
        case 'results': renderResults(container); break;
      }

      // Nav buttons
      const backBtn = document.getElementById('backBtn');
      const nextBtn = document.getElementById('nextBtn');
      backBtn.style.display = state.stepIndex === 0 ? 'none' : 'inline-block';
      nextBtn.style.display = current.key === 'results' ? 'none' : 'inline-block';
      nextBtn.textContent = 'Next';
    }

    /**** PAGE: Welcome ****/
    function renderWelcome(container) {
      container.innerHTML = `
        <div class="form-section info-card">
          <h3 style="margin-bottom:8px;">What this tool does</h3>
          <p>This quick guide (no login required) helps you understand your <strong>likely</strong> TSI status for <strong>English</strong> and <strong>Math</strong> and shows your next steps.</p>
          <p class="hint" style="margin-top:8px;">Final placement decisions are made by Lone Star College after reviewing official records.</p>
        </div>

        <div class="two-col">
          <div class="info-card">
            <strong>You’ll do three things:</strong>
            <ul style="margin:10px 0 0 18px;">
              <li>Confirm you’ve <em>applied</em></li>
              <li>Confirm you’ve <em>logged in & checked your checklist</em></li>
              <li>Answer brief questions for English and Math</li>
            </ul>
          </div>
          <div class="info-card">
            <strong>Important:</strong>
            <ul style="margin:10px 0 0 18px;">
              <li>If you say you meet a score threshold, you’ll still need to <em>send official scores</em> to LSC.</li>
              <li>This tool does not collect or submit official documents.</li>
            </ul>
          </div>
        </div>

        <div style="text-align:center; margin-top:20px;">
          <button class="btn btn-primary" id="startWizard">Start</button>
        </div>
      `;
      document.getElementById('startWizard').addEventListener('click', () => { state.stepIndex = 1; render(); });
      document.getElementById('navigationButtons').style.display = 'none';
    }

    /**** PAGE: Applied ****/
    function renderApplied(container) {
      container.innerHTML = `
        <div class="form-section">
          <h3>Have you applied to Lone Star College?</h3>
          <div class="stack-list" style="margin-top:8px;">
            <label class="stack-item"><input type="radio" name="applied" value="yes" ${state.answers.hasApplied===true?'checked':''}/> Yes</label>
            <label class="stack-item"><input type="radio" name="applied" value="no" ${state.answers.hasApplied===false?'checked':''}/> No</label>
          </div>
          <p class="hint" style="margin-top:8px;">If you haven’t applied yet, please apply first, then return here.</p>
        </div>

        ${state.answers.hasApplied === false ? `
          <div class="form-section warn-card" style="border-left:4px solid #ffb300;">
            <h4 style="margin-bottom:6px;">Apply first</h4>
            <p>Submit your application through GoApplyTexas, then come back to continue.</p>
            <div style="margin-top:10px;">
              <a class="btn btn-outline" href="#" target="_blank" rel="noopener">Apply at GoApplyTexas</a>
              <a class="btn btn-outline" href="#" target="_blank" rel="noopener">Admissions Checklist</a>
            </div>
          </div>
        ` : '' }
      `;

      document.querySelectorAll('input[name="applied"]').forEach(r => {
        r.addEventListener('change', e => { state.answers.hasApplied = e.target.value === 'yes'; render(); });
      });

      hookNav({
        canNext: () => state.answers.hasApplied !== null,
        onNext: () => { if (state.answers.hasApplied) state.stepIndex = 2; },
      });
    }

    /**** PAGE: Login ****/
    function renderLogin(container) {
      container.innerHTML = `
        <div class="form-section">
          <h3>Have you logged in to myLoneStar and checked your checklist?</h3>
          <div class="stack-list" style="margin-top:8px;">
            <label class="stack-item"><input type="radio" name="logged" value="yes" ${state.answers.hasLoggedIn===true?'checked':''}/> Yes</label>
            <label class="stack-item"><input type="radio" name="logged" value="no" ${state.answers.hasLoggedIn===false?'checked':''}/> No</label>
          </div>
        </div>

        ${state.answers.hasLoggedIn === false ? `
          <div class="form-section info-card">
            <h4 style="margin-bottom:6px;">How to log in & find your checklist</h4>
            <ol style="margin-left:18px;">
              <li>Go to <a class="inline-link" href="https://my.lonestar.edu" target="_blank" rel="noopener">my.lonestar.edu</a></li>
              <li>Click <strong>Get Email</strong> to find your LSC student email / NetID</li>
              <li>Click <strong>Get Password</strong> to set or reset your password</li>
              <li>Sign in → <em>Student Homepage</em> → <strong>Tasks</strong> → <strong>Checklist</strong></li>
            </ol>
            <div style="margin-top:10px;">
              <a class="btn btn-outline btn-small" href="https://my.lonestar.edu" target="_blank" rel="noopener">Open myLoneStar</a>
            </div>
            <p class="hint" style="margin-top:8px;">You can continue this guide now, but complete your checklist as soon as possible.</p>
          </div>
        ` : '' }
      `;

      document.querySelectorAll('input[name="logged"]').forEach(r => {
        r.addEventListener('change', e => { state.answers.hasLoggedIn = e.target.value === 'yes'; render(); });
      });

      hookNav({
        canNext: () => state.answers.hasLoggedIn !== null,
        onNext: () => { state.stepIndex = 3; },
      });
    }

    /**** PAGE: English ****/
    function renderEnglish(container) {
      container.innerHTML = `
        <div class="form-section">
          <h3>English (Reading & Writing)</h3>
          <p>Select what applies to you. This produces a <em>likely</em> status; official review is required.</p>
        </div>

        ${eligibilityBlock('english', true)}

        ${scoreCheckboxBlock('english')}

        <div style="margin-top:12px;">${previewPill('english')}</div>
      `;

      bindArea('english');
      hookNav({ canNext: () => true, onNext: () => { state.stepIndex = 4; } });
    }

    /**** PAGE: Math ****/
    function renderMath(container) {
      container.innerHTML = `
        <div class="form-section">
          <h3>Math</h3>
          <p>Select what applies to you. This produces a <em>likely</em> status; official review is required.</p>
        </div>

        ${eligibilityBlock('math', false)}

        ${scoreCheckboxBlock('math')}

        <div style="margin-top:12px;">${previewPill('math')}</div>
      `;

      bindArea('math');
      hookNav({ canNext: () => true, onNext: () => { state.stepIndex = 5; } });
    }

    /**** PAGE: Results ****/
    function renderResults(container) {
      const eng = computeDecision('english');
      const math = computeDecision('math');

      const engMethods = officialMethodsForArea('english');
      const mathMethods = officialMethodsForArea('math');

      container.innerHTML = `
        <div class="form-section">
          <h3>Your Likely Status</h3>
          <div class="two-col">
            ${resultCard('English', eng, engMethods, 'english')}
            ${resultCard('Math', math, mathMethods, 'math')}
          </div>
        </div>

        <div class="form-section info-card">
          <strong>Important notifications</strong>
          <ul style="margin:8px 0 0 18px;">
            <li>After you send official transcripts or test scores, <strong>check your myLoneStar email</strong> — we will email you when they are received.</li>
            <li>Also check your <strong>Checklist</strong> — it will be updated once exemption or TSI scores for both English and Math have been received and processed.</li>
          </ul>
        </div>
      `;
    }

    /**** SUBVIEWS ****/
    function eligibilityBlock(areaKey, includeESOL_CPP) {
      const lines = [
        ['degree', "I have an associate’s or higher degree"],
        ['transferCredit', `I completed a college-level ${areaKey==='english'?'English composition/writing':'Math'} course (for credit)`],
        ['priorReady', "A prior college already determined I was college-ready in this subject"],
        ['activeDuty', "I’m active duty (or served ≥ 3 years before enrolling)"],
        ['veteran', "I’m a veteran (honorable discharge/retired/released on/after Aug 1, 1990)"],
        includeESOL_CPP ? ['esol', "I’m in ESOL (English for Speakers of Other Languages)"] : null,
        ['level1', "I’m pursuing a Level 1 certificate"],
        includeESOL_CPP ? ['cpp', "I completed an approved high-school College Preparatory course (within 24 months)"] : null
      ].filter(Boolean);

      return `
        <div class="exemption-category">
          <div class="category-header ${isOpen(`${areaKey}-elig`)?'open':''}" onclick="toggleOpen('${areaKey}-elig')">
            <span>Eligibility (Credit, Degree, Military, Waivers)</span><span class="expand-icon">▼</span>
          </div>
          <div class="category-content ${isOpen(`${areaKey}-elig`)?'open':''}" id="${areaKey}-elig">
            <div class="stack-list">
              ${lines.map(([k, label]) => `
                <label class="stack-item">
                  <input type="checkbox" data-area="${areaKey}" data-key="${k}" ${state.answers[areaKey][k] ? 'checked':''}/> ${label}
                </label>
              `).join('')}
            </div>
            <p class="hint" style="margin-top:10px;">
              Waivers: ESOL (up to 15 credit hours without TSI) and some Level 1 certificates — confirm details with Advising.
            </p>
          </div>
        </div>
      `;
    }

    function scoreCheckboxBlock(areaKey) {
      const A = state.answers[areaKey];
      const isEng = areaKey === 'english';
      return `
        <div class="exemption-category">
          <div class="category-header ${isOpen(`${areaKey}-tests`)?'open':''}" onclick="toggleOpen('${areaKey}-tests')">
            <span>Test Scores (check only if you meet the threshold)</span><span class="expand-icon">▼</span>
          </div>
          <div class="category-content ${isOpen(`${areaKey}-tests`)?'open':''}" id="${areaKey}-tests">
            <p class="hint" style="margin-bottom:10px;">
              Checking a box here does not submit anything. You must still send <strong>official scores</strong> using the approved method(s).
            </p>
            <div class="stack-list">
              ${isEng ? `
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="sat_erw" ${A.sat_erw?'checked':''}/> Do you have an <strong>SAT Evidence-Based Reading & Writing</strong> score <strong>≥ ${CUTS.SAT.ERW}</strong>?</label>
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="act_new_er" ${A.act_new_er?'checked':''}/> Do you have an <strong>ACT (on/after 02/15/2023)</strong> English + Reading <strong>sum ≥ ${CUTS.ACT.NEW.ERsum}</strong>?</label>
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="act_old_eng_comp" ${A.act_old_eng_comp?'checked':''}/> Do you have an <strong>ACT (before 02/15/2023)</strong> with <strong>English ≥ ${CUTS.ACT.OLD.ENG}</strong> and <strong>Composite ≥ ${CUTS.ACT.OLD.COMP}</strong>?</label>
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="ged_rla" ${A.ged_rla?'checked':''}/> Do you have a <strong>GED Reasoning Through Language Arts</strong> score <strong>≥ ${CUTS.GED.RLA}</strong>?</label>
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="hiset_rw" ${A.hiset_rw?'checked':''}/> Do you have <strong>HiSET</strong> with <strong>Reading ≥ ${CUTS.HISET.READ}</strong>, <strong>Writing ≥ ${CUTS.HISET.WRITE}</strong>, and <strong>Essay ≥ ${CUTS.HISET.ESSAY}</strong>?</label>
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="staar_eng3" ${A.staar_eng3?'checked':''}/> Do you have <strong>STAAR English III</strong> score <strong>≥ ${CUTS.STAAR.ENG3}</strong>?</label>
              ` : `
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="sat_math" ${A.sat_math?'checked':''}/> Do you have an <strong>SAT Math</strong> score <strong>≥ ${CUTS.SAT.MATH}</strong>?</label>
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="act_new_math" ${A.act_new_math?'checked':''}/> Do you have an <strong>ACT (on/after 02/15/2023)</strong> <strong>Math ≥ ${CUTS.ACT.NEW.MATH}</strong>?</label>
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="act_old_math_comp" ${A.act_old_math_comp?'checked':''}/> Do you have an <strong>ACT (before 02/15/2023)</strong> with <strong>Math ≥ ${CUTS.ACT.OLD.MATH}</strong> and <strong>Composite ≥ ${CUTS.ACT.OLD.COMP}</strong>?</label>
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="ged_math" ${A.ged_math?'checked':''}/> Do you have a <strong>GED Math</strong> score <strong>≥ ${CUTS.GED.MATH}</strong>?</label>
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="hiset_math" ${A.hiset_math?'checked':''}/> Do you have a <strong>HiSET Math</strong> score <strong>≥ ${CUTS.HISET.MATH}</strong>?</label>
                <label class="stack-item"><input type="checkbox" data-area="${areaKey}" data-key="staar_alg2" ${A.staar_alg2?'checked':''}/> Do you have <strong>STAAR Algebra II</strong> score <strong>≥ ${CUTS.STAAR.ALG2}</strong>?</label>
              `}
            </div>
          </div>
        </div>
      `;
    }

    function previewPill(areaKey) {
      const d = computeDecision(areaKey);
      const cls = d.label === 'Likely Exempt' ? 'status-exempt'
               : d.label.startsWith('Waiver') ? 'status-warning'
               : 'status-needed';
      return `<span class="status-pill ${cls}">${d.label}</span> <span class="hint">${d.reason}</span>`;
    }

    function resultCard(title, d, methods, areaKey) {
      const cls = d.label === 'Likely Exempt' ? 'status-exempt'
               : d.label.startsWith('Waiver') ? 'status-warning'
               : 'status-needed';

      const testingLink = 'https://www.lonestar.edu/placement-testing-info.htm';

      let nextHtml = '';
      if (d.label === 'Likely Exempt') {
        nextHtml = `
          <p><strong>${title}:</strong> Send <em>official</em> documentation to confirm the exemption.</p>
          ${methods.length ? `
            <div class="exemption-category" style="margin-top:10px;">
              <div class="category-header open"><span>Official ways to send documentation (based on what you selected)</span><span></span></div>
              <div class="category-content open">
                <ul style="margin-left:18px;">
                  ${methods.map(m => `<li>${m}</li>`).join('')}
                </ul>
              </div>
            </div>
          ` : `
            <p class="hint">Select at least one qualifying item on the ${title} page to see the official submission methods.</p>
          `}
        `;
      } else if (d.label.startsWith('Waiver')) {
        nextHtml = `
          <p><strong>${title}:</strong> Meet with Advising to confirm the waiver and plan courses.</p>
          <ul style="margin-left:18px;">
            <li>ESOL waiver: up to 15 credit hours without TSI</li>
            <li>Level 1 certificate: testing may not be required for some programs</li>
          </ul>
        `;
      } else {
        nextHtml = `
          <p><strong>${title}:</strong> You’ll likely need the TSIA2 assessment.</p>
          <ul style="margin-left:18px;">
            <li><a class="inline-link" href="${testingLink}" target="_blank" rel="noopener">See the Lone Star testing page for what to do next</a></li>
            <li>Review prep resources before testing</li>
            <li>If you believe you qualify for an exemption, send official documentation</li>
          </ul>
        `;
      }

      return `
        <div class="exemption-category">
          <div class="category-header open">
            <span>${title}</span><span class="status-pill ${cls}">${d.label}</span>
          </div>
          <div class="category-content open">
            <p style="margin-bottom:10px;">${d.reason}</p>
            ${d.details ? `<ul class="hint" style="margin-left:18px;">${d.details.map(x=>`<li>${x}</li>`).join('')}</ul>` : ''}
            <div style="margin-top:12px;">${nextHtml}</div>
          </div>
        </div>
      `;
    }

    /**** DECISION ENGINE ****/
    function computeDecision(areaKey) {
      const a = state.answers[areaKey];

      if (a.degree)        return { label: 'Likely Exempt', reason: 'You reported an associate’s or higher degree.' };
      if (a.transferCredit) return { label: 'Likely Exempt', reason: 'You reported completed college-level coursework in this subject.' };
      if (a.priorReady)    return { label: 'Likely Exempt', reason: 'A prior college determined you’re college-ready in this subject.' };
      if (a.activeDuty || a.veteran) return { label: 'Likely Exempt', reason: 'You reported qualifying military status.' };

      // Score-based: any checked means they attest they meet the threshold
      if (areaKey === 'english') {
        if (a.sat_erw || a.act_new_er || a.act_old_eng_comp || a.ged_rla || a.hiset_rw || a.staar_eng3) {
          return { label: 'Likely Exempt', reason: 'You reported a qualifying English score that meets the threshold.' };
        }
      } else {
        if (a.sat_math || a.act_new_math || a.act_old_math_comp || a.ged_math || a.hiset_math || a.staar_alg2) {
          return { label: 'Likely Exempt', reason: 'You reported a qualifying Math score that meets the threshold.' };
        }
      }

      if (a.esol)  return { label: 'Waiver may apply (ESOL)', reason: 'ESOL students may enroll up to 15 credit hours without TSI.', details: ['Confirm with Advising.'] };
      if (a.level1) return { label: 'Waiver may apply (Level 1)', reason: 'Some Level 1 certificate programs may not require TSI.', details: ['Confirm with Advising.'] };

      if (a.cpp && areaKey === 'english') {
        return { label: 'Likely Exempt', reason: 'You reported an approved high-school College Preparatory English course (within 24 months). Send official transcript.' };
      }

      return { label: 'Likely Needs TSIA2', reason: 'No qualifying exemption or waiver selected.' };
    }

    function officialMethodsForArea(areaKey) {
      const a = state.answers[areaKey];
      let methods = [];

      // Degree / transfer / prior ready -> transcripts
      if (a.degree || a.transferCredit || a.priorReady) methods.push(...OFFICIAL_METHODS.transcript);

      // Military
      if (a.activeDuty || a.veteran) methods.push(...OFFICIAL_METHODS.military);

      // CPP (English only)
      if (a.cpp && areaKey === 'english') methods.push(...OFFICIAL_METHODS.cpp);

      // Scores
      if (areaKey === 'english') {
        if (a.sat_erw) methods.push(...OFFICIAL_METHODS.sat);
        if (a.act_new_er || a.act_old_eng_comp) methods.push(...OFFICIAL_METHODS.act);
        if (a.ged_rla) methods.push(...OFFICIAL_METHODS.ged);
        if (a.hiset_rw) methods.push(...OFFICIAL_METHODS.hiset);
        if (a.staar_eng3) methods.push(...OFFICIAL_METHODS.staar);
      } else {
        if (a.sat_math) methods.push(...OFFICIAL_METHODS.sat);
        if (a.act_new_math || a.act_old_math_comp) methods.push(...OFFICIAL_METHODS.act);
        if (a.ged_math) methods.push(...OFFICIAL_METHODS.ged);
        if (a.hiset_math) methods.push(...OFFICIAL_METHODS.hiset);
        if (a.staar_alg2) methods.push(...OFFICIAL_METHODS.staar);
      }

      // De-duplicate
      return [...new Set(methods)];
    }

    /**** BINDINGS & HELPERS ****/
    function bindArea(areaKey) {
      document.querySelectorAll(`[data-area="${areaKey}"][data-key]`).forEach(el => {
        el.addEventListener('change', e => {
          const k = e.target.getAttribute('data-key');
          state.answers[areaKey][k] = e.target.checked;
          render(); // refresh preview pill
        });
      });
    }

    function hookNav({ canNext, onNext }) {
      const nextBtn = document.getElementById('nextBtn');
      nextBtn.onclick = () => {
        if (!canNext || canNext()) {
          if (onNext) onNext();
          else state.stepIndex++;
          render();
        }
      };
      const backBtn = document.getElementById('backBtn');
      backBtn.onclick = () => {
        if (state.stepIndex > 0) { state.stepIndex--; render(); }
      };
    }

    function toggleOpen(id) { state.ui.open[id] = !state.ui.open[id]; render(); }
    function isOpen(id) { return !!state.ui.open[id]; }
    window.toggleOpen = toggleOpen;

    // Reset & Start Over
    document.getElementById('resetPageBtn').addEventListener('click', () => {
      const key = STEPS[state.stepIndex].key;
      if (key === 'applied') state.answers.hasApplied = null;
      if (key === 'login') state.answers.hasLoggedIn = null;
      if (key === 'english') state.answers.english = blankArea(true);
      if (key === 'math') state.answers.math = blankArea(false);
      render();
    });

    document.getElementById('startOverBtn').addEventListener('click', () => {
      state.stepIndex = 0;
      state.answers = { hasApplied:null, hasLoggedIn:null, english:blankArea(true), math:blankArea(false) };
      state.ui = { open:{} };
      render();
    });

    // Print
    document.getElementById('printBtn').addEventListener('click', () => window.print());

    // Initial render
    render();
  </script>
</body>
</html>
